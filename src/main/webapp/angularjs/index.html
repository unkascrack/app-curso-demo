<!DOCTYPE html>
<html lang="es" ng-app='myApp'>
<head>
	<meta charset="utf-8">
	<title>Demo - Cat치logo de Cursos</title>
	<link rel="stylesheet" href="../css/normalize.css">
	<link rel="stylesheet" href="../css/style.css">
	<link rel="stylesheet" href="../css/jquery-ui-1.10.3.custom.min.css">
</head>
<body>
	<div loading>Loading...</div>

	<h1><a ng-href="#/">Cat치logo de Cursos</a></h1>
	<hr/>
	
	<div ng-view></div>

	<br/>
	<a href="../index.html">Volver</a>
	<hr/>
	<footer align="right">
		&copy;2013 Carlos Alonso Gonz치lez
	</footer>
	
	<script src="../js/comun.js" type="text/javascript"></script>
	<script src="../js/jquery-1.9.1.min.js" type="text/javascript"></script>
	<script src="../js/jquery-ui-1.10.3.custom.min.js" type="text/javascript"></script>
	
	<script src="js/libs/angular.min.js" type="text/javascript"></script>
	<script src="js/libs/angular-resource.min.js" type="text/javascript"></script>
	<script src="js/libs/angular-cookies.min.js" type="text/javascript"></script>
	<script src="js/libs/angular-sanitize.min.js" type="text/javascript"></script>
	<script src="js/libs/angular-bootstrap.min.js" type="text/javascript"></script>
	
	<script type="text/javascript">
		var app = angular.module('myApp', ['myApp.directives', 'myApp.services']);
		
		// ROUTES 
		app.config(['$routeProvider', function($routeProvider) {
			$routeProvider
				.when('/cursos', {templateUrl:'templates/cursos/list.html'})
				.when('/cursos/new', {controller: 'NewCursoController', templateUrl:'templates/cursos/edit.html'})
				.when('/cursos/:id', {templateUrl:'templates/cursos/show.html'})
				.when('/cursos/:id/edit', {controller: 'EditCursoController', templateUrl:'templates/cursos/edit.html'})
				.otherwise({redirectTo: '/cursos'});
		}]);
	</script>
	
	<script type="text/javascript">
		// DIRECTIVAS
		var directives = angular.module('myApp.directives', []);
		
		directives.directive('focus', function() {
			return {
				link: function(scope, element, attrs, controller) {
					element[0].focus();
				}
			};
		});
		
		directives.directive('loading', ['$rootScope', function($rootScope) {
			return {
				link: function(scope, element, attrs) {
					element.addClass('hide');
					$rootScope.$on('$routeChangeStart', function() {
						element.removeClass('hide');
					});
					$rootScope.$on('$routeChangeSuccess', function() {
						element.addClass('hide');
					});
				}
			};
		}]);
	</script>
		
	<script type="text/javascript">
		// SERVICES
		var services = angular.module('myApp.services', ['ngResource']);
		
		services.factory('Curso', ['$resource', function($resource) {
			return $resource('../rest/jackson/cursos/:id', {id: '@id'});
		}]);
		
		services.factory('Tutor', ['$resource', function($resource) {
			return $resource('../rest/jackson/tutores/:id', {id: '@id'});
		}]);
		
		services.factory('MultiCursoLoader', ['Curso', '$q', function (Curso, $q) {
			return function() {
				var delay = $q.defer();
				Curso.query(function(cursos) {
					delay.resolve(cursos);
				}, function() {
					delay.reject('Unable to fetch cursos');
				});
				return delay.promise;
			};
		}]);
		
		services.factory('CursoLoader', ['Curso', '$route', '$q', function (Curso, $route, $q) {
			return function() {
				var delay = $q.defer();
				Curso.get({id: $route.current.params.cursoId}, function(curso) {
					delay.resolve(curso);
				}, function() {
					delay.reject('Unable to fetch curso '+ $route.current.params.cursoId);
				});
				return delay.promise;
			};
		}]);
		
		services.factory('MultiTutorLoader', ['Tutor', '$q', function (Tutor, $q) {
			return function() {
				var delay = $q.defer();
				Tutor.query(function(tutores) {
					delay.resolve(tutores);
				}, function() {
					delay.reject('Unable to fetch tutores');
				});
				return delay.promise;
			};
		}]);
	</script>
		
	<script type="text/javascript">
		// CONTROLLERS
 		app.controller('ListCursoController', ['$scope', 'Curso', function($scope, Curso) {
 			$scope.cursos = Curso.query({activo:true});
 		}]);
		
		app.controller('NewCursoController', ['$scope', '$location', 'Curso', function($scope, $location, Curso) {
			$scope.curso = new Curso();
			
			$scope.save = function() {
				alert('NewCursoController save');
				$scope.curso.$save(function(curso) {
					$location.path(curso.id);
				});
			};
		}]);
		
		app.controller('ShowCursoController', ['$scope', '$location', '$routeParams', 'Curso', function($scope, $location, $routeParams, Curso) {
			$scope.curso = Curso.get({id:$routeParams.id});
			
			$scope.edit = function() {
				$location.path(curso.id+'/edit');
			};
			$scope.remove = function() {
				$scope.curso.$delete(function(curso) {
					$location.path('/cursos');
				});
			};
		}]);
		
		app.controller('EditCursoController', ['$scope', '$location', '$routeParams', 'Curso', function($scope, $location, $routeParams, Curso) {
			$scope.curso = Curso.get({id:$routeParams.id});
			
			$scope.save = function() {
				alert('EditCursoController save');
				$scope.curso.$save(function(curso) {
					$location.path(curso.id);
				});
			};
		}]);
		
		app.controller('LitTutorController', ['$scope', 'Tutor', function($scope, Tutor) {
			$scope.tutores = Tutor.query();
		}]);
		
		app.controller('LitNivelController', ['$scope', function($scope) {
			$scope.niveles = ['BASICO', 'INTERMEDIO', 'AVANZADO'];
		}]);
	</script>		

	<script type="text/javascript">
		//MOCKS
		var mockCursos =  
			[
				{
					"id":1,
					"activo":true,
					"tutor":1,
					"titulo":"Curso 1",
					"nivel":"BASICO",
					"horas":20,
					"temario":"temario1.txt"
				},
				{
					"id":2,
					"activo":true,
					"tutor":1,
					"titulo":"Curso 2",
					"nivel":"INTERMEDIO",
					"horas":40,
					"temario":"temario2.txt"
				},
				{
					"id":3,
					"activo":true,
					"tutor":2,
					"titulo":"Curso 3",
					"nivel":"AVANZADO",
					"horas":120,
					"temario":null
				}
			];

		var mockTutores =  
			[
				{
					"id":1,
					"nombre":"Carlos",
					"apellidos":"Alonso Gonz치lez"
				},
				{
					"id":2,
					"nombre":"Perico",
					"apellidos":"Palotes"
				}
			];		
	</script>
</body>
</html>