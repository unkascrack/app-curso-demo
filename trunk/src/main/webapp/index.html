<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="utf-8">
	<title>Ember Starter Kit</title>
	<link rel="stylesheet" href="resources/css/normalize.css">
	<link rel="stylesheet" href="resources/css/style.css">
</head>
<body>
	<script type="text/x-handlebars">
    	{{partial 'header'}}
    	{{outlet}}   
    	{{partial 'footer'}}
	</script>
	

	<script type="text/x-handlebars" data-template-name="_header">
		<header>
			<h1>{{#linkTo index}}Catálogo de Cursos{{/linkTo}}</h1>
		</header>
		<hr/>
	</script>

	<script type="text/x-handlebars" data-template-name="_footer">
		<br/>
		<hr/>
		<footer align="right">
			&copy;2013 Carlos Alonso González
		</footer>
	</script>
	
	<script type="text/x-handlebars" data-template-name="cursos/list">
		<h2>LISTADO DE CURSOS</h2>
		{{#linkTo cursos.new}}Nuevo{{/linkTo}}

		<center>
		<table border="1" cellspacing="0" cellpadding="0" width="80%">
			<thead>
				<tr>
					<th width="20"></th>
					<th>Titulo</th>
					<th width="100">Nivel</th>
					<th width="50">Horas</th>
					<th width="50"></th>
				</tr>
			</thead>
			<tbody>
				{{#unless model}}
					<tr>
						<td colspan="5" align="center">No hay ningún curso activo</td>
					</tr>
				{{else}}
					{{#each model}}
						<tr>
							<td>{{id}}</td>
							<td>{{titulo}}</td>
							<td>{{nivel}}</td>
							<td>{{horas}}</td>
							<td>
								{{#linkTo cursos.edit this}}Editar{{/linkTo}}
							</td>
						</tr>
					{{/each}}
				{{/unless}}				
			</tbody>
			<tfoot>
				<tr>
					<td colspan="5">footer</td>
				</tr>
			</tfoot>
		</table>
		</center>
	</script>
	
	<script type="text/x-handlebars" data-template-name="cursos/new">
		{{partial 'cursos/form'}}
	</script>
	
	<script type="text/x-handlebars" data-template-name="cursos/edit">
		{{partial 'cursos/form'}}
	</script>
	
	<script type="text/x-handlebars" data-template-name="cursos/_form">
		<h2>EDICIÓN CURSO</h2>
		<p>
			<label>Activo</label>
			{{view Ember.Checkbox checkedBinding='activo'}}
		</p>

		<p>
			<label>Profesor</label>
			{{view Ember.Select
                    contentBinding='controller.tutores'
					optionValuePath='content.id'
  					optionLabelPath='content.nombreCompleto'
					valueBinding='tutor.id'
                    prompt='Seleccione un tutor'
			}}
		</p>

		<p>
			<label>Titulo</label>
			{{view Ember.TextField 
				valueBinding='titulo'}}
		</p>

		<p>
			<label>Nivel</label>
			{{view Ember.Select 
					contentBinding='App.niveles'
					valueBinding='nivel'
                    prompt='Seleccione el nivel'
			}}
		</p>

		<p>
			<label>Horas</label>
			{{view Ember.TextField valueBinding='horas'}}
		</p>

		<p>
			<button {{action save}}>Guardar</button>
			<button {{action cancel}}>Cancelar</button>
		</p>
	</script>
	
	<script src="resources/js/libs/jquery-1.9.1.js"></script>
	<script src="resources/js/libs/handlebars-1.0.0-rc.3.js"></script>
	<script src="resources/js/libs/ember-1.0.0-rc.3.js"></script>
	<script src="resources/js/libs/ember-data-latest.js"></script>
	<!-- <script src="resources/js/app.js"></script> -->
	<script type="text/javascript">
App = Ember.Application.create({
	LOG_TRANSITIONS: true
});

//route
App.Router.map(function() {
	this.resource('cursos', { path: '/cursos' }, function() {
		this.route('new', { path: 'new' }),
	    this.route('edit', { path: ':curso_id/edit' })
	})
});

App.IndexRoute = Ember.Route.extend({
	redirect: function() {
		this.transitionTo('cursos');
	}
});

App.CursosRoute = Ember.Route.extend({
	model: function() {
		this.get('store.defaultTransaction').rollback();
		return App.Curso.find();
	},
	renderTemplate: function() {
		this.render('cursos/list');
	}
});

App.CursosNewRoute = Ember.Route.extend({
	renderTemplate: function(){
		this.render('cursos/new', {into:'application'});
	},
	setupController: function(controller, model) {
		var model = this.get('store.defaultTransaction').createRecord(App.Curso);
		controller.set('tutores', App.Tutor.find());
		controller.set('content', model);
	}
});

App.CursosNewController = Ember.ObjectController.extend({
	tutores: null,
	save: function() {
		this.get('store.defaultTransaction').commit();
		this.transitionToRoute('index');
	},
	cancel: function() {
		this.content.deleteRecord();
		this.transitionToRoute('index');
	}
});

App.CursosEditRoute = Ember.Route.extend({
	renderTemplate: function(){
		this.render('cursos/edit', {into:'application'});
	},
	setupController: function(controller, model) {
		controller.set('tutores', App.Tutor.find());
	}
});

App.CursosEditController = Ember.ObjectController.extend({
	save: function() {
		this.get('store.defaultTransaction').commit();
		this.transitionToRoute('index');
	},
	cancel: function() {
		this.get('store.defaultTransaction').rollback();
		this.transitionToRoute('index');
	}
});


App.niveles = ['BASICO', 'INTERMEDIO', 'AVANZADO'];

//ember-data
App.Store = DS.Store.extend({
	revision: 12,
	adapter: 'DS.FixtureAdapter'
	//adapter: 'DS.RESTAdapter'
});

//model
App.Tutor = DS.Model.extend({
	nombre: DS.attr('string'),
	apellidos: DS.attr('string'),
	nombreCompleto: function() {
		return this.get('nombre') + ' ' + this.get('apellidos');
	}.property('nombre', 'apellidos')
});

App.Curso = DS.Model.extend({
	activo: DS.attr('boolean'),
	tutor: DS.belongsTo('App.Tutor'),
	titulo: DS.attr('string'),
	nivel: DS.attr('string'),
	horas: DS.attr('number'),
	plain: function () {
        return this.get('id') + ' '+ this.get('activo');
    }.property('activo')
});

App.Curso.FIXTURES = 
[
	{
		"id":1,
		"activo":true,
		"tutor": 1,
		"titulo":"Curso 1",
		"nivel":"BASICO",
		"horas":20,
		"nombreTemario":null,
		"contenidoTemario":null
	},
	{
		"id":2,
		"activo":true,
		"tutor": 1,
		"titulo":"Curso 2",
		"nivel":"INTERMEDIO",
		"horas":40,
		"nombreTemario":null,
		"contenidoTemario":null
	},
	{
		"id":3,
		"activo":true,
		"tutor": 1,
		"titulo":"Curso 3",
		"nivel":"INTERMEDIO",
		"horas":60,
		"nombreTemario":null,
		"contenidoTemario":null
	},
	{
		"id":4,
		"activo":true,
		"tutor": [2],
		"titulo":"Curso 3",
		"nivel":"AVANZADO",
		"horas":120,
		"nombreTemario":null,
		"contenidoTemario":null
	}
];

App.Tutor.FIXTURES = 
[
	{
		"id":1,
		"nombre":"Carlos",
		"apellidos":"Alonso González"
	},
	{
		"id":2,
		"nombre":"Perico",
		"apellidos":"Palotes"
	}
];
	</script>
</body>
</html>